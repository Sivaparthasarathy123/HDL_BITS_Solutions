module top_module(
    input clk,
    input in,
    input reset,    // Synchronous reset
    output done
); 
    parameter [1:0] START  = 2'b00,
                    DATA   = 2'b01,
                    STOP   = 2'b10,
                    ERROR  = 2'b11;
    reg [1:0]state,next_state;
    reg [7:0]count;
    always@(*)begin
        case(state)
            START : next_state = in ? START : DATA;
            DATA  : next_state = count<8 ? DATA : (in ? STOP : ERROR);
            STOP  : next_state = in ? START : DATA;
            ERROR : next_state = in ? START : ERROR;
            default:next_state = START;
        endcase
    end
    
    always@(posedge clk)begin
        if(reset)
            state <= START;
        else
            state <= next_state;
    end
    
    always@(posedge clk)begin
        if(reset)
            count <= 4'd0;
        else if(state == DATA)
            count <= count + 4'd1;
        else
            count <= 4'd0;
    end
    
    assign done = (state == STOP);
        
endmodule
